<!DOCTYPE html>
<head>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
<html lang="zh-CN">
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>MindFit - èº«å¿ƒç„¦è™‘è‡ªåŠ©å·¥å…·</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="style.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#3B82F6",
            secondary: "#10B981",
            accent: "#8B5CF6",
            neutral: "#F3F4F6",
            dark: "#1F2937",
            light: "#F9FAFB",
          },
          fontFamily: {
            sans: ["PingFang SC", "Helvetica Neue", "Arial", "sans-serif"],
          },
        },
      },
    };
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .transition-smooth {
        transition: all 0.3s ease;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-balance {
        text-wrap: balance;
      }
      .btn-primary {
        @apply w-full py-3 bg-primary text-white rounded-lg font-medium flex items-center justify-center;
      }
      .badge {
        @apply text-xs px-2 py-1 rounded-full;
      }
    }
    /* ç¾åŒ–æµ‹è¯„æ»‘æ† */
input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: linear-gradient(to right, #3B82F6, #10B981);
  outline: none;
  transition: background 0.3s;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid #3B82F6;
  cursor: pointer;
  transition: transform 0.2s;
}
input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.2);
}

input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid #3B82F6;
  cursor: pointer;
}
    <style>
/* ç»“æœè¿›åº¦æ¡ï¼ˆä¸ä¾èµ–å¤–éƒ¨åº“ï¼‰ */
.result-gauge { background:#f1f5f9; border-radius:999px; height:10px; overflow:hidden; }
.result-gauge > .bar { height:100%; width:0; background:linear-gradient(90deg,#3B82F6,#10B981); transition:width .6s ease; }
.result-gauge-label { display:flex; justify-content:space-between; font-size:12px; color:#475569; margin:.5rem 0 .25rem; }
.badge-chip { display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#4f46e5; margin-left:.5rem; }
.copy-btn { font-size:12px; color:#2563eb; cursor:pointer; }
.copy-btn:hover { text-decoration:underline; }
</style>

  <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<!-- é¡µé¢å†…å®¹ -->

<script>
  // ç­‰å¾…æ–‡æ¡£åŠ è½½å®Œæˆå†æ‰§è¡Œä»£ç 
  document.addEventListener("DOMContentLoaded", () => {
    // é¡µé¢åˆ‡æ¢é€»è¾‘
    // ç”Ÿæˆ/æ›´æ–°ç»“æœè¿›åº¦æ¡ï¼ˆå®¹å™¨ä¸å­˜åœ¨å°±è‡ªåŠ¨åˆ›å»ºï¼‰
function renderGauge(containerId, percent, labelText){
  const box = document.getElementById(containerId) || (()=>{
    // æ²¡æœ‰å®¹å™¨å°±è‡ªåŠ¨æ’åˆ°å¯¹åº”ç»“æœå¡é¡¶éƒ¨
    const auto = document.createElement('div');
    auto.id = containerId;
    const card = containerId.startsWith('light') ? document.getElementById('lightResult') : document.getElementById('proResult');
    if(card){ card.prepend(auto); }
    return auto;
  })();
  if(!box) return;
  box.innerHTML = `
    <div class="result-gauge-label">
      <span>${labelText || 'ç»¼åˆç»“æœ'}</span>
      <span>${percent}%</span>
    </div>
    <div class="result-gauge"><div class="bar" style="width:${percent}%;"></div></div>
  `;
}
// å·²æœ‰ï¼šæ ¹æ® total åˆ¤å®š levelï¼ˆä½æ°´å¹³/éœ€è¦å…³æ³¨/ä¼˜å…ˆå¹²é¢„ï¼‰
document.getElementById('lightSummary').innerHTML =
  `ç„¦è™‘æ€»åˆ†ï¼š<b>${total}</b>ï¼ˆ8â€“40ï¼‰ï½œåˆ†çº§ï¼š<span class="badge-chip">${level}</span>ï½œå‡†å¤‡åº¦ï¼š<b>${readiness}</b>/5`;

// é€šç”¨ï¼šæŠŠç»“æœå¡é‡Œçš„æ–‡å­—å»ºè®®å¤åˆ¶åˆ°å‰ªè´´æ¿
function attachCopyAdvice(btnId, adviceContainerId){
  const btn = document.getElementById(btnId);
  if(!btn) return;
  btn.onclick = async ()=>{
    const ul = document.getElementById(adviceContainerId);
    const text = ul ? Array.from(ul.querySelectorAll('li')).map(li=>`â€¢ ${li.textContent.trim()}`).join('\n') : '';
    try{
      await navigator.clipboard.writeText(text || 'ï¼ˆæ²¡æœ‰å¯å¤åˆ¶çš„å»ºè®®ï¼‰');
      if(typeof showToast==='function') showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); else alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    }catch(e){ alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶'); }
  };
}

    function navigateTo(id) {
      console.log("Navigating to:", id);
      pages.forEach((p) => p.classList.add("hidden"));
      const target = document.getElementById(id);
      if (!target) return;
      target.classList.remove("hidden");
      pageTitle.textContent = titleMap[id] || "MindFit";

      if (pageHistory[pageHistory.length - 1] !== id) {
        pageHistory.push(id);
      }

      window.scrollTo(0, 0);
    }

    // è¿”å›æŒ‰é’®äº‹ä»¶ç»‘å®š
    document.getElementById("backBtn").addEventListener("click", () => {
      if (pageHistory.length > 1) {
        pageHistory.pop();
        navigateTo(pageHistory[pageHistory.length - 1]);
      }
    });
  });
  // 1) è¿›åº¦æ¡ï¼šæŠŠ 8~40 åˆ†æ˜ å°„ä¸º 0~100%
const percent = Math.round((total - 8) / 32 * 100);
renderGauge('lightGauge', percent, 'è½»æµ‹è¯„æ€»è§ˆ');

// 2) ä¸€é”®å¤åˆ¶å»ºè®®ï¼ˆæŒ‰é’®ä¸å­˜åœ¨å°±è‡ªåŠ¨ç”Ÿæˆï¼‰
if(!document.getElementById('lightCopy')){
  const tools = document.createElement('div');
  tools.className = 'mt-2';
  tools.innerHTML = `<span id="lightCopy" class="copy-btn"><i class="fa fa-copy mr-1"></i>å¤åˆ¶å»ºè®®</span>`;
  document.getElementById('lightResult').prepend(tools);
}
attachCopyAdvice('lightCopy','lightAdvice');

// 3) è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœ
document.getElementById('lightResult').scrollIntoView({behavior:'smooth', block:'start'});
// 1) è¿›åº¦æ¡ï¼šç›´æ¥ç”¨ç»¼åˆåˆ† overallï¼ˆ0~100ï¼‰
renderGauge('proGauge', overall, 'ä¸“ä¸šæµ‹è¯„ç»¼åˆ');

// 2) ä¸€é”®å¤åˆ¶è®¡åˆ’
if(!document.getElementById('proCopy')){
  const tools = document.createElement('div');
  tools.className = 'mt-2';
  tools.innerHTML = `<span id="proCopy" class="copy-btn"><i class="fa fa-copy mr-1"></i>å¤åˆ¶å°è®¡åˆ’</span>`;
  document.getElementById('proResult').prepend(tools);
}
attachCopyAdvice('proCopy','proPlan');

// 3) è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœ
document.getElementById('proResult').scrollIntoView({behavior:'smooth', block:'start'});

</script>

<!-- é¡µé¢å†…å®¹ -->

<body class="bg-gray-50 font-sans text-dark min-h-screen">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50">
    <div class="flex items-center justify-between px-4 py-3">
      <div class="flex items-center">
        <button id="backBtn" class="p-2 text-gray-500 hover:text-primary transition-smooth">
          <i class="fa fa-arrow-left text-lg"></i>
        </button>
        <h1 id="pageTitle" class="text-xl font-medium ml-2">MindFit èº«å¿ƒç®¡ç†</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button class="p-2 text-gray-500 hover:text-primary transition-smooth" data-target="myRecordsPage">
          <i class="fa fa-list-alt text-lg"></i>
        </button>
        <button class="p-2 text-gray-500 hover:text-primary transition-smooth" data-target="myBadgesPage">
          <i class="fa fa-star-o text-lg"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- æç¤º Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 top-16 z-[60] hidden">
    <div class="bg-gray-900 text-white text-sm px-3 py-2 rounded-md shadow-lg"></div>
  </div>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="pt-16 pb-20 min-h-screen">
    <!-- é¦–é¡µ -->
    <section id="homePage" class="page active">
      <div class="px-4 py-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-[clamp(1.5rem,3vw,1.8rem)] font-bold">èº«å¿ƒç„¦è™‘è‡ªåŠ©å·¥å…·</h2>
          <div class="flex items-center">
            <span class="text-sm text-gray-500 mr-2">æˆ‘çš„è¿›åº¦</span>
            <div class="w-28 h-2 bg-gray-200 rounded-full overflow-hidden">
              <i class="ph ph-chart-line text-slate-500 text-2xl"></i>

              <div id="progressBar" class="h-full bg-primary rounded-full" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- åŠŸèƒ½å¡ç‰‡ç½‘æ ¼ -->
        <div class="grid grid-cols-2 gap-4 mb-8">
          <!-- è½»æµ‹è¯„ -->
          <div class="feature-card bg-white rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="assessmentPage">
            <div class="w-14 h-14 rounded-full bg-pink-100 flex items-center justify-center mb-3">
             <i class="ph ph-heartbeat text-pink-500 text-2xl"></i>

            </div>
            <h3 class="text-base font-medium text-center">èº«å¿ƒè½»æµ‹è¯„</h3>
          </div>

          <!-- è‡ªåŠ¨æ€ç»´è®°å½• -->
          <!-- ğŸ§  CBT æ•™ç¨‹ä»‹ç»åŒºåŸŸ -->
<section class="cbt-intro" style="max-width: 700px; margin: 0 auto; padding: 30px 20px;">
  <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;">ğŸ§  ä»€ä¹ˆæ˜¯ CBTï¼ˆè®¤çŸ¥è¡Œä¸ºç–—æ³•ï¼‰ï¼Ÿ</h2>
  <p style="line-height: 1.6;">
    CBT æ˜¯ä¸€ç§ç§‘å­¦çš„å¿ƒç†è®­ç»ƒæ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹å˜æƒ…ç»ªå’Œè¡Œä¸ºã€‚MindFit æŠŠå®ƒæ‹†è§£æˆ 3 ä¸ªç»ƒä¹ æ­¥éª¤ï¼š
  </p>
  <ol style="margin-top: 1em; margin-left: 1.2em; line-height: 1.6;">
    <li><strong>Step 1ï¼š</strong> è‡ªåŠ¨æ€ç»´è®°å½•ï¼ˆè§‰å¯Ÿä½ çš„æƒ³æ³•ï¼‰</li>
    <li><strong>Step 2ï¼š</strong> æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡ï¼ˆæ¢ä¸ªè§’åº¦çœ‹é—®é¢˜ï¼‰</li>
    <li><strong>Step 3ï¼š</strong> è¡Œä¸ºå®éªŒæŒ‡å—ï¼ˆé€šè¿‡è¡ŒåŠ¨æŒ‘æˆ˜è¿™äº›æƒ³æ³•ï¼‰</li>
  </ol>
  <p style="margin-top: 1em;">ä½ ä¸éœ€è¦ä¸€æ­¥åˆ°ä½ï¼Œåªè¦å¼€å§‹ç¬¬ä¸€æ­¥ï¼ŒMindFit å°±ä¼šé™ªä½ æ…¢æ…¢æ¥ ğŸŒ¿</p>
  <a href="#auto-record" style="display: inline-block; margin-top: 1em; padding: 10px 20px; background: #3b82f6; color: white; text-decoration: none; border-radius: 6px;">ğŸ‘‰ å¼€å§‹ç¬¬ä¸€æ­¥ç»ƒä¹ </a>
</section>

          <div class="feature-card bg-white rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="thoughtRecordPage">
            <div class="w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center mb-3">
             <i class="ph ph-pencil-simple text-blue-500 text-2xl"></i>

            </div>
            <h3 class="text-base font-medium text-center">è‡ªåŠ¨æ€ç»´è®°å½•</h3>
          </div>

          <!-- æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡ -->
          <div class="feature-card bg-white rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="emotionRegulationPage">
            <div class="w-14 h-14 rounded-full bg-green-100 flex items-center justify-center mb-3">
             <i class="ph ph-chat-centered-dots text-green-500 text-2xl"></i>

            </div>
            <h3 class="text-base font-medium text-center">æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡</h3>
          </div>

          <!-- è¡Œä¸ºå®éªŒæŒ‡å— -->
          <div class="feature-card bg-white rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="behaviorExperimentPage">
            <div class="w-14 h-14 rounded-full bg-purple-100 flex items-center justify-center mb-3">
             <i class="ph ph-flask text-purple-500 text-2xl"></i>

            </div>
            <h3 class="text-base font-medium text-center">è¡Œä¸ºå®éªŒæŒ‡å—</h3>
          </div>

          <!-- å†¥æƒ³/æ­£å¿µç»ƒä¹  -->
          <div class="feature-card bg-white rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="mindfulnessPage">
            <div class="w-14 h-14 rounded-full bg-yellow-100 flex items-center justify-center mb-3">
            <i class="ph ph-headphones text-yellow-500 text-2xl"></i>

            </div>
            <h3 class="text-base font-medium text-center">å†¥æƒ³/æ­£å¿µç»ƒä¹ </h3>
          </div>
        </div>

        <!-- æœ€è¿‘è®°å½•ï¼ˆåŠ¨æ€ï¼‰ -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">æœ€è¿‘è®°å½•</h3>
            <button class="text-primary text-sm flex items-center" data-target="myRecordsPage">
              æŸ¥çœ‹å…¨éƒ¨ <i class="fa fa-angle-right ml-1"></i>
            </button>
          </div>
          <div id="recentList" class="space-y-3"></div>
        </div>

        <!-- æ–°è§£é”å¾½ç« ï¼ˆåŠ¨æ€ï¼‰ -->
        <div id="badgeBanner" class="hidden bg-gradient-to-r from-primary to-accent rounded-xl p-5 text-white mb-6">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="text-lg font-semibold mb-1">æ­å–œè§£é”æ–°å¾½ç« ï¼</h3>
              <p id="badgeBannerText" class="text-sm opacity-90 mb-3"></p>
              <button class="bg-white text-primary text-sm px-3 py-1.5 rounded-full font-medium" data-target="myBadgesPage">
                æŸ¥çœ‹æˆ‘çš„å¾½ç« 
              </button>
            </div>
            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
              <i class="fa fa-star text-2xl"></i>
            </div>
          </div>
        </div>

        <!-- ä¸ºä½ æ¨èï¼ˆåŠ¨æ€ï¼‰ -->
        <div>
          <h3 class="text-lg font-semibold mb-4">ä¸ºä½ æ¨è</h3>
          <div id="recommendList" class="space-y-4"></div>
        </div>
      </div>
    </section>

    <!-- èº«å¿ƒè½»æµ‹è¯„ -->
    <section id="assessmentPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">èº«å¿ƒè½»æµ‹è¯„</h2>
          <p class="text-gray-500 text-sm">9 é¢˜ 5 åˆ†é‡è¡¨ + BMI & ä¸»è§‚æ„Ÿå—ï¼Œç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®</p>
        </div>

        <!-- BMI + ä¸»è§‚æ„Ÿå— -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">åŸºç¡€è‡ªè¯„</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm text-gray-600 mb-1">èº«é«˜ï¼ˆcmï¼‰</label>
              <input id="heightInput" type="number" min="80" max="230" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ä¾‹å¦‚ 165" />
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">ä½“é‡ï¼ˆkgï¼‰</label>
              <input id="weightInput" type="number" min="20" max="250" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ä¾‹å¦‚ 55" />
            </div>
          </div>
          <div class="mt-3">
            <label class="block text-sm text-gray-600 mb-1">æ­¤åˆ»å¯¹èº«ä½“çš„ä¸»è§‚æ„Ÿå—</label>
            <select id="bodyFeel" class="w-full p-3 border border-gray-200 rounded-lg">
              <option value="">è¯·é€‰æ‹©</option>
              <option value="èˆ’é€‚">èˆ’é€‚</option>
              <option value="ç´§ç»·">ç´§ç»·</option>
              <option value="ç–²æƒ«">ç–²æƒ«</option>
              <option value="ä¸è‡ªä¿¡">ä¸è‡ªä¿¡</option>
            </select>
          </div>
          <div class="mt-3 text-sm text-gray-600">
            <span id="bmiText" class="font-medium"></span>
          </div>
        </div>

        <!-- 9é¢˜é‡è¡¨ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">9 é¢˜é‡è¡¨ï¼ˆ1=ä»ä¸ï¼Œ5=æ€»æ˜¯ï¼‰</h3>
          <div id="qList" class="space-y-3"></div>
        </div>

        <!-- ç»“æœ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <button id="btnAssess" class="btn-primary"><i class="fa fa-check mr-2"></i>æäº¤å¹¶ç”Ÿæˆå»ºè®®</button>
          <div id="assessResult" class="hidden mt-4 border border-gray-100 rounded-lg p-4 bg-gray-50">
            <p class="text-sm text-gray-600 mb-2">å»ºè®® & ä»Šæ—¥å°ä»»åŠ¡ï¼š</p>
            <ul id="adviceList" class="list-disc pl-5 space-y-1 text-sm"></ul>
          </div>
        </div>
      </div>
    </section>

    <!-- è‡ªåŠ¨æ€ç»´è®°å½• -->
    <section id="thoughtRecordPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">è‡ªåŠ¨æ€ç»´è®°å½•</h2>
          <p class="text-gray-500 text-sm">è®°å½•å¹¶åˆ†æä½ çš„æƒ³æ³•ä¸æƒ…ç»ªååº”ï¼ˆèšç„¦èº«æ/è‡ªæˆ‘è¯„ä»·/ç¤¾äº¤åª’ä½“ç­‰ï¼‰</p>
        </div>

        <!-- æ•æ‰ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">æ•æ‰</h3>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">æƒ…å¢ƒ</label>
            <select id="trContext" class="w-full p-3 border border-gray-200 rounded-lg">
              <option value="">è¯·é€‰æ‹©æˆ–è¾“å…¥æƒ…å¢ƒ</option>
              <option>å¤–è²Œè¢«è¯„ä»·</option>
              <option>ç¤¾äº¤åª’ä½“å¯¹æ¯”</option>
              <option>ä½“é‡æ³¢åŠ¨</option>
              <option>ç©¿è¡£ä¸è‡ªä¿¡</option>
              <option>é¥®é£Ÿæ§åˆ¶å¤±æ§</option>
              <option>è‡ªæˆ‘æ€€ç–‘</option>
              <option>å®¶åº­æ²Ÿé€š</option>
              <option>å…¶ä»–ï¼ˆè¯·åœ¨ä¸‹æ–¹è¾“å…¥ï¼‰</option>
            </select>
            <input id="trContextCustom" type="text" placeholder="å¦‚é€‰æ‹©'å…¶ä»–'ï¼Œè¯·åœ¨æ­¤è¾“å…¥å…·ä½“æƒ…å¢ƒ" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" />
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">å½“æ—¶çš„æƒ³æ³•</label>
            <textarea id="trThought" placeholder="è¯·æè¿°ä½ å½“æ—¶çš„æƒ³æ³•..." rows="4" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">è¯æ®ï¼ˆæ”¯æŒ/åå¯¹ï¼‰</label>
            <textarea id="trEvidence" placeholder="æœ‰æ²¡æœ‰è¯æ®æ”¯æŒæˆ–åé©³è¿™ä¸ªæƒ³æ³•ï¼Ÿ" rows="3" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="">
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-medium text-gray-700">æƒ…ç»ªå¼ºåº¦</label>
              <span id="emotionScore" class="text-primary font-semibold">5</span>
            </div>
            <input id="trEmotion" type="range" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary" oninput="document.getElementById('emotionScore').textContent = this.value" />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>è½»å¾®</span><span>ä¸­ç­‰</span><span>å¼ºçƒˆ</span>
            </div>
          </div>
        </div>

        <!-- æ“ä½œ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6 space-y-3">
          <button id="btnSaveTR" class="btn-primary"><i class="fa fa-save mr-2"></i>ä¿å­˜è®°å½•</button>
          <div class="grid grid-cols-2 gap-3">
            <button id="btnExportCSV" class="py-2 border border-primary text-primary rounded-lg font-medium text-sm"><i class="fa fa-table mr-1"></i>å¯¼å‡º CSV</button>
            <button id="btnPrint" class="py-2 border border-gray-300 text-gray-700 rounded-lg font-medium text-sm"><i class="fa fa-file-pdf-o mr-1"></i>æ‰“å°ä¸º PDF</button>
          </div>
        </div>

        <!-- ç¤ºä¾‹è¾“å‡ºï¼ˆæ”¹ä¸ºåŠ¨æ€æœ€è¿‘ä¸€æ¬¡ï¼‰ -->
        <div class="bg-white rounded-xl p-5 card-shadow">
          <h3 class="text-lg font-semibold mb-4">æœ€è¿‘ä¸€æ¬¡è®°å½•</h3>
          <div id="trPreview" class="border border-gray-100 rounded-lg p-4 bg-gray-50 text-sm text-gray-700">
            æš‚æ— è®°å½•ï¼Œä¿å­˜åä¼šæ˜¾ç¤ºé¢„è§ˆã€‚
          </div>
        </div>
      </div>
    </section>

    <!-- æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡ -->
    <section id="emotionRegulationPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡</h2>
          <p class="text-gray-500 text-sm">é€šè¿‡ç®€å•ç»ƒä¹ ï¼Œç¼“è§£ç„¦è™‘ã€é‡è·å¹³è¡¡</p>
        </div>

        <!-- è½®æ’­å®¹å™¨ -->
        <div class="relative mb-8">
          <div class="carousel-container overflow-x-auto scrollbar-hide pb-4">
            <div class="carousel-track flex space-x-4 min-w-max px-1">
              <!-- å¡ç‰‡ 1ï¼šæ·±å‘¼å¸ -->
              <div class="emotion-card bg-white rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0" data-card="deepBreath">
                <div class="h-36 bg-blue-50 relative">
                  <img src="https://picsum.photos/300/200?random=13" alt="æ·±å‘¼å¸ç»ƒä¹ " class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">æ·±å‘¼å¸ç»ƒä¹ </h3>
                  </div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">4-2-6 å‘¼å¸ï¼šå¸æ°” 4 ç§’ - åœ 2 ç§’ - å‘¼æ°” 6 ç§’ï¼Œé‡å¤ 5â€“10 æ¬¡ã€‚</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    æ ‡è®°å®Œæˆ
                  </button>
                </div>
              </div>

              <!-- å¡ç‰‡ 2ï¼šäº”æ„Ÿè§‰å¯Ÿ -->
              <div class="emotion-card bg-white rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0 opacity-90" data-card="fiveSenses">
                <div class="h-36 bg-green-50 relative">
                  <img src="https://picsum.photos/300/200?random=14" alt="äº”æ„Ÿè§‰å¯Ÿç»ƒä¹ " class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">äº”æ„Ÿè§‰å¯Ÿ</h3>
                  </div>
                  <div class="absolute top-3 right-3 hidden done-sticker bg-green-500 text-white text-xs px-2 py-1 rounded-full">å·²å®Œæˆ</div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">è¯´å‡ºä½ çœ‹åˆ°/æ‘¸åˆ°/å¬åˆ°/é—»åˆ°/å°åˆ°çš„ 5-4-3-2-1 æ ·ä¸œè¥¿ã€‚</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    æ ‡è®°å®Œæˆ
                  </button>
                </div>
              </div>

              <!-- å¡ç‰‡ 3ï¼šæ­£å¿µé¥®é£Ÿ -->
              <div class="emotion-card bg-white rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0" data-card="mindfulEating">
                <div class="h-36 bg-yellow-50 relative">
                  <img src="https://picsum.photos/300/200?random=15" alt="æ­£å¿µé¥®é£Ÿç»ƒä¹ " class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">æ­£å¿µé¥®é£Ÿ</h3>
                  </div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">é€‰ä¸€é¢—è‘¡è„å¹²æˆ–ä¸€å°å—é£Ÿç‰©ï¼Œæ…¢æ…¢è§‚å¯Ÿã€å—…é—»ã€å“å°ï¼Œç»†åš¼æ…¢å’½ã€‚</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    æ ‡è®°å®Œæˆ
                  </button>
                </div>
              </div>

              <!-- å¡ç‰‡ 4ï¼šæƒ…ç»ªå‘½å -->
              <div class="emotion-card bg-white rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0" data-card="nameEmotion">
                <div class="h-36 bg-purple-50 relative">
                  <img src="https://picsum.photos/300/200?random=16" alt="æƒ…ç»ªå‘½åç»ƒä¹ " class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">æƒ…ç»ªå‘½å</h3>
                  </div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">åœä¸‹ 30 ç§’ï¼Œè¾¨è®¤æƒ…ç»ªå¹¶å‘½åï¼šç„¦è™‘/ç´§ç»·/ç¾æ„§/ä¸å®‰â€¦æ¥çº³å®ƒçš„å­˜åœ¨ã€‚</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    æ ‡è®°å®Œæˆ
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- æŒ‡ç¤ºå™¨ -->
          <div class="flex justify-center mt-4 space-x-1.5">
            <span class="w-2.5 h-2.5 rounded-full bg-primary"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-gray-300"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-gray-300"></span>
            <span class="w-2.5 h-2.5 rounded-full bg-gray-300"></span>
          </div>
        </div>

        <!-- ç»ƒä¹ ç»Ÿè®¡ï¼ˆåŠ¨æ€ï¼‰ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">ç»ƒä¹ è¿›åº¦</h3>
          <div class="flex justify-between items-center mb-4">
            <div>
              <p class="text-sm text-gray-500">æœ¬å‘¨å·²å®Œæˆ</p>
              <p id="statWeek" class="text-xl font-bold">0/7</p>
            </div>
            <div class="w-16 h-16 rounded-full border-4 border-primary/20 flex items-center justify-center">
              <div class="text-center">
                <p class="text-xs text-gray-500">è¿ç»­å¤©æ•°</p>
                <p id="statStreak" class="text-lg font-bold text-primary">0</p>
              </div>
            </div>
            <div>
              <p class="text-sm text-gray-500">æ€»å®Œæˆæ¬¡æ•°</p>
              <p id="statTotal" class="text-xl font-bold">0</p>
            </div>
          </div>
          <div class="w-full bg-gray-100 rounded-full h-2.5">
            <div id="statBar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
          </div>
        </div>

        <!-- ç›¸å…³æ¨èï¼ˆåŠ¨æ€ï¼‰ -->
        <div>
          <h3 class="text-lg font-semibold mb-4">ç›¸å…³æ¨è</h3>
          <div id="emotionRecs" class="space-y-4"></div>
        </div>
      </div>
    </section>

    <!-- è¡Œä¸ºå®éªŒæŒ‡å— -->
    <section id="behaviorExperimentPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">è¡Œä¸ºå®éªŒæŒ‡å—</h2>
          <p class="text-gray-500 text-sm">ç”¨å°å®éªŒéªŒè¯ç„¦è™‘æ€§ä¿¡å¿µï¼Œè·å¾—æ–°è¯æ®</p>
        </div>

        <!-- è¯´æ˜ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-3">ä»€ä¹ˆæ˜¯è¡Œä¸ºå®éªŒï¼Ÿ</h3>
          <div class="prose prose-sm text-gray-700">
            <p>è¡Œä¸ºå®éªŒæ˜¯ CBT çš„æ ¸å¿ƒæŠ€æœ¯ï¼šè®¾è®¡å¹¶æ‰§è¡Œå°å‹ã€ä½é£é™©çš„è¡ŒåŠ¨ï¼ŒéªŒè¯â€œæˆ‘æ‹…å¿ƒçš„äº‹æ˜¯å¦çœŸçš„ä¼šå‘ç”Ÿâ€ã€‚</p>
            <ul class="list-disc pl-5 space-y-1 mt-1">
              <li>å‘ç°è®¤çŸ¥ä¸ç°å®çš„å·®è·</li>
              <li>æ”¶é›†åè¯ï¼ŒæŒ‘æˆ˜ä¸åˆç†ä¿¡å¿µ</li>
              <li>é€šè¿‡ä½“éªŒå½¢æˆæ–°çš„ã€æ›´å¥åº·çš„è®¤çŸ¥</li>
            </ul>
          </div>
        </div>

        <!-- è®°å½•æ¨¡æ¿ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">å®éªŒè®°å½•</h3>
            <span class="text-xs bg-green-50 text-green-600 px-2 py-1 rounded-full">è‡ªåŠ¨ä¿å­˜</span>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">æˆ‘çš„æ‹…å¿§ä¿¡å¿µ</label>
            <textarea id="bxBelief" rows="3" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ä¾‹å¦‚ï¼šå¦‚æœæˆ‘åœ¨æœ‹å‹é¢å‰åƒä¸œè¥¿ï¼Œä»–ä»¬ä¼šè§‰å¾—æˆ‘å¤±æ§â€¦"></textarea>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">å°æ­¥å°è¯•è®¾è®¡</label>
            <div class="space-y-3">
              <input id="bxStep1" type="text" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ç¬¬ä¸€æ­¥ï¼šä¾‹å¦‚ï¼Œåœ¨ç†Ÿæ‚‰çš„ç¯å¢ƒä¸‹ä¸å¥½å‹ä¸€èµ·åƒä¸€å°ä»½ç‚¹å¿ƒâ€¦" />
              <input id="bxStep2" type="text" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ç¬¬äºŒæ­¥ï¼šâ€¦â€¦" />
              <input id="bxStep3" type="text" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="ç¬¬ä¸‰æ­¥ï¼šâ€¦â€¦" />
            </div>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">æˆ‘é¢„æµ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</label>
            <textarea id="bxPredict" rows="2" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">å®é™…ç»“æœè®°å½•</label>
            <textarea id="bxActual" rows="3" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="mb-3">
            <label class="block text-sm font-medium text-gray-700 mb-2">ç»“è®ºä¸æ–°çš„è®¤è¯†</label>
            <textarea id="bxLearn" rows="3" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <button id="btnSaveBX" class="btn-primary"><i class="fa fa-save mr-2"></i>ä¿å­˜å®éªŒè®°å½•</button>
        </div>

        <!-- å†å²å®éªŒï¼ˆåŠ¨æ€ï¼‰ -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">å†å²å®éªŒè®°å½•</h3>
            <button class="text-primary text-sm" id="btnViewAllBX">æŸ¥çœ‹å…¨éƒ¨</button>
          </div>
          <div id="bxList" class="space-y-3"></div>
        </div>
      </div>
    </section>

    <!-- å†¥æƒ³/æ­£å¿µç»ƒä¹  -->
    <section id="mindfulnessPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">å†¥æƒ³/æ­£å¿µç»ƒä¹ </h2>
          <p class="text-gray-500 text-sm">3â€“5 åˆ†é’Ÿå¼•å¯¼ï¼Œéšæ—¶è¿›å…¥å¹³é™</p>
        </div>

        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <div class="flex flex-col items-center">
            <audio id="audio" preload="none">
              <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg" />
            </audio>

            <div class="w-32 h-32 rounded-full bg-gradient-to-br from-purple-400 to-primary flex items-center justify-center mb-5">
              <i class="fa fa-play text-white text-3xl" id="playPauseIcon"></i>
            </div>

            <h3 class="text-lg font-semibold mb-1">3 åˆ†é’Ÿå‘¼å¸å†¥æƒ³</h3>
            <p class="text-sm text-gray-500 mb-5">å¦‚æœéŸ³é¢‘åŠ è½½æ…¢ï¼Œå¯ä»…ç”¨è®¡æ—¶ç»ƒä¹ </p>

            <div class="w-full mb-4">
              <div class="flex justify-between text-xs text-gray-500 mb-1">
                <span id="currentTime">00:00</span>
                <span id="totalTime">03:00</span>
              </div>
              <input id="seekBar" type="range" min="0" max="180" value="0" class="w-full h-1.5 bg-gray-200 rounded-lg accent-primary" />
            </div>

            <div class="flex items-center justify-between w-full max-w-xs">
              <button id="btnStepBack" class="text-gray-500 hover:text-primary transition-smooth">
                <i class="fa fa-step-backward"></i>
              </button>
              <button id="playPauseBtn" class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center">
                <i class="fa fa-play"></i>
              </button>
              <button id="btnStepForward" class="text-gray-500 hover:text-primary transition-smooth">
                <i class="fa fa-step-forward"></i>
              </button>
            </div>

            <div class="w-full mt-5 flex items-center">
              <i class="fa fa-volume-up text-gray-500 mr-2"></i>
              <input id="volumeBar" type="range" min="0" max="1" step="0.01" value="0.7" class="w-full h-1 bg-gray-200 rounded-lg accent-primary" />
            </div>

            <button id="btnCache" class="mt-5 text-sm text-primary flex items-center">
              <i class="fa fa-download mr-1"></i> è®°ä¸ºå·²ç¼“å­˜ï¼ˆç¦»çº¿æç¤ºï¼‰
            </button>
          </div>
        </div>

        <!-- æ–‡å­—æŒ‡å¯¼ -->
        <div class="bg-white rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-3">ç»ƒä¹ æŒ‡å¯¼</h3>
          <p class="text-sm text-gray-600">æ‰¾ä¸€ä¸ªå®‰é™ã€èˆ’é€‚çš„ç¯å¢ƒï¼Œä¿æŒè‡ªç„¶å‘¼å¸ã€‚å½“æ³¨æ„åŠ›èµ°ç¥æ—¶ï¼Œæ¸©å’Œåœ°æŠŠå®ƒå¸¦å›å‘¼å¸ï¼Œä¸è¯„åˆ¤è‡ªå·±ã€‚</p>
          <button id="startPracticeBtn" class="w-full mt-5 py-3 bg-primary text-white rounded-lg font-medium">
            å¼€å§‹è®¡æ—¶ç»ƒä¹ ï¼ˆ3 åˆ†é’Ÿï¼‰
          </button>
        </div>

        <!-- æ›´å¤šç»ƒä¹  -->
        <div>
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">æ›´å¤šç»ƒä¹ </h3>
            <button class="text-primary text-sm">æŸ¥çœ‹å…¨éƒ¨</button>
          </div>
          <div class="space-y-3">
            <div class="bg-white rounded-lg p-4 card-shadow flex items-center">
              <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mr-3 flex-shrink-0">
                <i class="fa fa-headphones text-secondary"></i>
              </div>
              <div class="flex-grow">
                <h4 class="font-medium">5 åˆ†é’Ÿèº«ä½“æ‰«æ</h4>
                <p class="text-xs text-gray-500">å…³æ³¨èº«ä½“æ„Ÿå—ï¼Œé‡Šæ”¾ç´§å¼ </p>
              </div>
              <div class="flex-shrink-0">
                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full mr-2">5:00</span>
                <button class="text-primary"><i class="fa fa-play-circle-o"></i></button>
              </div>
            </div>
            <div class="bg-white rounded-lg p-4 card-shadow flex items-center">
              <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mr-3 flex-shrink-0">
                <i class="fa fa-headphones text-accent"></i>
              </div>
              <div class="flex-grow">
                <h4 class="font-medium">ç¡å‰æ”¾æ¾å†¥æƒ³</h4>
                <p class="text-xs text-gray-500">ç¼“è§£å…¥ç¡å›°éš¾</p>
              </div>
              <div class="flex-shrink-0">
                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full mr-2">8:00</span>
                <button class="text-primary"><i class="fa fa-play-circle-o"></i></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- æˆ‘çš„è®°å½• -->
    <section id="myRecordsPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">æˆ‘çš„è®°å½•</h2>
          <p class="text-gray-500 text-sm">æŸ¥çœ‹ä¸ç®¡ç†ä½ çš„æ‰€æœ‰è®°å½•</p>
        </div>

        <!-- ç­›é€‰ -->
        <div class="bg-white rounded-xl p-4 card-shadow mb-6">
          <div class="flex flex-wrap gap-2 mb-3">
            <button data-filter="all" class="filter-btn px-3 py-1.5 bg-primary text-white text-sm rounded-full">å…¨éƒ¨è®°å½•</button>
            <button data-filter="thought" class="filter-btn px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-full">è‡ªåŠ¨æ€ç»´</button>
            <button data-filter="emotion" class="filter-btn px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-full">æƒ…ç»ªç»ƒä¹ </button>
            <button data-filter="experiment" class="filter-btn px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-full">è¡Œä¸ºå®éªŒ</button>
            <button data-filter="mindfulness" class="filter-btn px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-full">å†¥æƒ³</button>
            <button data-filter="assessment" class="filter-btn px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-full">æµ‹è¯„</button>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <i class="fa fa-calendar text-gray-500 mr-2"></i>
              <span class="text-sm text-gray-600">æœ€è¿‘ 30 å¤©</span>
            </div>
            <div class="space-x-2">
              <button id="btnExportAll" class="text-primary text-sm"><i class="fa fa-download mr-1"></i>å¯¼å‡ºæ‰€æœ‰ CSV</button>
              <button id="btnClearAll" class="text-red-500 text-sm"><i class="fa fa-trash-o mr-1"></i>æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            </div>
          </div>
        </div>

        <!-- åˆ—è¡¨ -->
        <div id="recordList" class="space-y-3"></div>
      </div>
    </section>

    <!-- æˆ‘çš„å¾½ç«  -->
    <section id="myBadgesPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">æˆ‘çš„å¾½ç« </h2>
          <p class="text-gray-500 text-sm">è®°å½•ä½ çš„åšæŒä¸è¿›æ­¥</p>
        </div>

        <div class="mb-8">
          <h3 class="text-lg font-semibold mb-4">å·²è§£é”</h3>
          <div id="badgeUnlocked" class="grid grid-cols-3 gap-4"></div>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">å¾…è§£é”</h3>
          <div id="badgeLocked" class="grid grid-cols-3 gap-4"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <footer class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-40">
    <div class="flex justify-around items-center py-3">
      <button class="nav-btn flex flex-col items-center text-primary" data-target="homePage">
        <i class="fa fa-home text-lg mb-1"></i><span class="text-xs">é¦–é¡µ</span>
      </button>
      <button class="nav-btn flex flex-col items-center text-gray-500" data-target="emotionRegulationPage">
        <i class="fa fa-heart text-lg mb-1"></i><span class="text-xs">ç»ƒä¹ </span>
      </button>
      <button class="nav-btn flex flex-col items-center text-gray-500" data-target="myRecordsPage">
        <i class="fa fa-book text-lg mb-1"></i><span class="text-xs">è®°å½•</span>
      </button>
      <button class="nav-btn flex flex-col items-center text-gray-500" data-target="myBadgesPage">
        <i class="fa fa-star-o text-lg mb-1"></i><span class="text-xs">å¾½ç« </span>
      </button>
    </div>
  </footer>

  <script>
    /*****************
     * åŸºç¡€å·¥å…· & å­˜å‚¨
     *****************/
    const DB_KEY = "mindfit_db_v1";

    const defaultDB = () => ({
      records: [],          // æ€ç»´è®°å½•
      emotions: [],         // æƒ…ç»ªç»ƒä¹ å®Œæˆ {card, ts}
      experiments: [],      // è¡Œä¸ºå®éªŒ
      mindfulness: [],      // å†¥æƒ³ç»ƒä¹  {seconds, ts}
      assessments: [],      // æµ‹è¯„ç»“æœ
      badges: {},           // å¾½ç« å¸ƒå°”
      streak: { count: 0, lastDate: "" }, // è¿ç»­å¤©æ•°
      cachedAudio: false,   // å†¥æƒ³éŸ³é¢‘ç¼“å­˜æ ‡è®°ï¼ˆæç¤ºç”¨ï¼‰
    });

    const loadDB = () => {
      try {
        const raw = localStorage.getItem(DB_KEY);
        return raw ? JSON.parse(raw) : defaultDB();
      } catch (e) {
        return defaultDB();
      }
    };

    const saveDB = (db) => localStorage.setItem(DB_KEY, JSON.stringify(db));

    const todayStr = () => {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    };

    const fmtTime = (ts) => {
      const d = new Date(ts);
      const pad = (n) => (n < 10 ? "0" + n : n);
      return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    };

    const showToast = (msg) => {
      const wrap = document.getElementById("toast");
      const box = wrap.firstElementChild;
      box.textContent = msg;
      wrap.classList.remove("hidden");
      setTimeout(() => wrap.classList.add("hidden"), 1800);
    };

    // streak æ›´æ–°ï¼šæ¯å¤©ä»»æ„æ“ä½œä¸€æ¬¡è®°ä¸ºæ´»è·ƒ
    const touchStreak = (db) => {
      const t = todayStr();
      if (db.streak.lastDate === t) return;
      // åˆ¤æ–­æ˜¯å¦è¿ç»­
      const last = db.streak.lastDate ? new Date(db.streak.lastDate) : null;
      const y = new Date(t);
      const one = 24 * 60 * 60 * 1000;
      const isConsecutive = last && (y - last) / one === 1;
      db.streak.count = isConsecutive ? (db.streak.count + 1) : 1;
      db.streak.lastDate = t;
    };

    /*****************
     * é¡µé¢å¯¼èˆª
     *****************/
    document.addEventListener("DOMContentLoaded", () => {
      const pages = document.querySelectorAll(".page");
      const backBtn = document.getElementById("backBtn");
      const pageTitle = document.getElementById("pageTitle");
      const featureCards = document.querySelectorAll(".feature-card");
      const otherLinks = document.querySelectorAll("[data-target]");
      const navBtns = document.querySelectorAll(".nav-btn");

      let pageHistory = ["homePage"];

      const titleMap = {
        homePage: "MindFit èº«å¿ƒç®¡ç†",
        assessmentPage: "èº«å¿ƒè½»æµ‹è¯„",
        thoughtRecordPage: "è‡ªåŠ¨æ€ç»´è®°å½•",
        emotionRegulationPage: "æƒ…ç»ªè°ƒèŠ‚å¡ç‰‡",
        behaviorExperimentPage: "è¡Œä¸ºå®éªŒæŒ‡å—",
        mindfulnessPage: "å†¥æƒ³/æ­£å¿µç»ƒä¹ ",
        myRecordsPage: "æˆ‘çš„è®°å½•",
        myBadgesPage: "æˆ‘çš„å¾½ç« ",
      };

      function navigateTo(id) {
        pages.forEach((p) => p.classList.add("hidden"));
        const target = document.getElementById(id);
        if (!target) return;
        target.classList.remove("hidden");
        pageTitle.textContent = titleMap[id] || "MindFit";
        if (pageHistory[pageHistory.length - 1] !== id) pageHistory.push(id);
        window.scrollTo(0, 0);
        // è¿›å…¥é¡µé¢æ—¶æ¸²æŸ“
        switch (id) {
          case "homePage":
            renderHome();
            break;
          case "thoughtRecordPage":
            renderTRPreview();
            break;
          case "emotionRegulationPage":
            renderEmotionStats();
            renderEmotionRecs();
            break;
          case "behaviorExperimentPage":
            renderBXList();
            break;
          case "myRecordsPage":
            renderRecordList("all");
            break;
          case "myBadgesPage":
            renderBadges();
            break;
          case "assessmentPage":
            renderAssessment();
            break;
        }
      }

      featureCards.forEach((c) => c.addEventListener("click", () => navigateTo(c.dataset.target)));
      otherLinks.forEach((c) => c.addEventListener("click", () => navigateTo(c.dataset.target)));
      navBtns.forEach((c) => c.addEventListener("click", () => navigateTo(c.dataset.target)));

      backBtn.addEventListener("click", () => {
        if (pageHistory.length > 1) {
          pageHistory.pop();
          navigateTo(pageHistory[pageHistory.length - 1]);
        }
      });

      /*****************
       * è½»æµ‹è¯„ï¼ˆ9é¢˜ï¼‰
       *****************/
      const QUESTIONS = [
        "ç…§é•œå­æˆ–ç¿»çœ‹ç…§ç‰‡æ—¶ï¼Œæˆ‘ä¼šç‰¹åˆ«å…³æ³¨è‡ªå·±çš„æŸäº›èº«ä½“éƒ¨ä½",
        "æˆ‘ä¼šæŠŠè‡ªå·±å’Œç¤¾äº¤åª’ä½“ä¸Šçš„â€œå®Œç¾èº«æâ€æ¯”è¾ƒ",
        "åƒå®Œå–œæ¬¢çš„é£Ÿç‰©åï¼Œæˆ‘ä¼šæ„Ÿåˆ°åæ‚”æˆ–æ„§ç–š",
        "å¦‚æœå¯¹è‡ªå·±çš„å¤–è²Œä¸æ»¡æ„ï¼Œæˆ‘ä¼šæƒ…ç»ªä½è½æˆ–å¿ƒæƒ…å—åˆ°å½±å“",
        "æˆ‘ä¼šç»™è‡ªå·±åˆ¶å®šä¸¥æ ¼çš„é¥®é£Ÿæˆ–è¿åŠ¨è®¡åˆ’ï¼Œè‹¥æœªå®Œæˆä¼šè‡ªè´£",
        "å› ä¸ºæ‹…å¿ƒèº«æï¼Œæˆ‘ä¼šé¿å…æ‹ç…§æˆ–å‚åŠ ç¤¾äº¤æ´»åŠ¨",
        "æˆ‘è§‰å¾—ç±»ä¼¼äºâ€œå¦‚æœæˆ‘å˜å¾—æ›´å¥½çœ‹ï¼Œç”Ÿæ´»ä¼šæ›´é¡ºåˆ©â€è¿™ç±»æƒ³æ³•æœ‰ä¸€å®šé“ç†",
        "æˆ‘æƒ³æ‘†è„±è¿™äº›ç„¦è™‘æƒ³æ³•ï¼Œä½†ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹",
        "å¦‚æœæœ‰ç®€å•å¯æ“ä½œçš„å¿ƒç†è‡ªåŠ©ç»ƒä¹ ï¼ˆä¾‹å¦‚æ€ç»´è®°å½•ã€æƒ…ç»ªå¡ç‰‡ç­‰ï¼‰ï¼Œæˆ‘æ„¿æ„å°è¯•",
      ];

      function renderAssessment() {
        // BMI æ–‡æœ¬
        const h = document.getElementById("heightInput");
        const w = document.getElementById("weightInput");
        const bmiText = document.getElementById("bmiText");
        const updateBMI = () => {
          const hv = parseFloat(h.value) || 0;
          const wv = parseFloat(w.value) || 0;
          if (!hv || !wv) {
            bmiText.textContent = "";
            return;
          }
          const bmi = (wv / Math.pow(hv / 100, 2)).toFixed(1);
          let label = "åŠŸèƒ½å¥åº·è§’åº¦ï¼šå…³æ³¨èº«ä½“èƒ½åšä»€ä¹ˆï¼Œè€Œéæ•°å­—ã€‚";
          if (bmi < 18.5) label = "æç¤ºï¼šå¯èƒ½åç˜¦ï¼Œæ³¨æ„è¥å…»ä¸èƒ½é‡è¡¥å……ã€‚";
          else if (bmi < 24) label = "æç¤ºï¼šæ€»ä½“è‰¯å¥½ï¼Œç»§ç»­ä¿æŒå‡è¡¡ä¸è§‰å¯Ÿã€‚";
          else if (bmi < 28) label = "æç¤ºï¼šé€‚åº¦è°ƒæ•´é¥®é£Ÿä¸æ´»åŠ¨ï¼Œå¾ªåºæ¸è¿›ã€‚";
          else label = "æç¤ºï¼šå»ºè®®åœ¨ä¸“ä¸šæŒ‡å¯¼ä¸‹ç¨³æ­¥ç®¡ç†ä¸ç›‘æµ‹ã€‚";
          bmiText.textContent = `BMIâ‰ˆ${bmi}ã€‚${label}`;
        };
        h.oninput = updateBMI;
        w.oninput = updateBMI;

        // æ¸²æŸ“ 9 é¢˜
        const qList = document.getElementById("qList");
        if (!qList.dataset.rendered) {
          qList.innerHTML = QUESTIONS.map((q, i) => {
            return `<div>
                <label class="block text-sm text-gray-700 mb-1">${i + 1}. ${q}</label>
                <input type="range" min="1" max="5" value="3" class="w-full h-2 bg-gray-200 rounded-lg accent-primary assess-item" data-idx="${i}">
                <div class="flex justify-between text-xs text-gray-400"><span>1 ä»ä¸</span><span>5 æ€»æ˜¯</span></div>
              </div>`;
          }).join("");
          qList.dataset.rendered = "1";
        }
      }

      document.getElementById("btnAssess").addEventListener("click", () => {
        const db = loadDB();
        const vals = [...document.querySelectorAll(".assess-item")].map((x) => Number(x.value));
        if (vals.length !== QUESTIONS.length) {
          showToast("è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®");
          return;
        }
        const height = parseFloat(document.getElementById("heightInput").value) || null;
        const weight = parseFloat(document.getElementById("weightInput").value) || null;
        const bodyFeel = document.getElementById("bodyFeel").value || "";

        const score = vals.reduce((a, b) => a + b, 0); // 9~45
        const ts = Date.now();

        // ç”Ÿæˆå»ºè®®
        const advice = [];
        if (score >= 30) advice.push("å»ºè®®ä¼˜å…ˆä½¿ç”¨ï¼šæ·±å‘¼å¸ + äº”æ„Ÿè§‰å¯Ÿï¼Œæ¯å¤© 2 æ¬¡ï¼Œæ¯æ¬¡ 2 åˆ†é’Ÿã€‚");
        if (score < 30) advice.push("å»ºè®®ç»´æŒï¼šæ¯æ—¥ 1 æ¬¡æ­£å¿µå‘¼å¸ + ä¸€æ¬¡è‡ªæˆ‘è‚¯å®šè¯­ã€‚");
        if (bodyFeel === "ä¸è‡ªä¿¡") advice.push("é˜…è¯»ï¼šèº«ä½“ä¸­ç«‹å…¥é—¨ï¼Œå°è¯•å†™ä¸‹ 3 æ¡èº«ä½“åŠŸèƒ½æ„Ÿæ©ã€‚");
        if (bodyFeel === "ç´§ç»·") advice.push("ä»Šæ—¥å°ä»»åŠ¡ï¼š4-2-6 å‘¼å¸ 10 è½®ï¼Œæ”¾æ¾è‚©é¢ˆä¼¸å±• 5 åˆ†é’Ÿã€‚");
        if (bodyFeel === "ç–²æƒ«") advice.push("ä»Šæ—¥å°ä»»åŠ¡ï¼šæ—©ç‚¹ä¼‘æ¯ï¼›æ™šé—´ 3 åˆ†é’Ÿå†¥æƒ³ã€‚");

        db.assessments.push({
          ts,
          score,
          vals,
          height,
          weight,
          bodyFeel,
        });
        touchStreak(db);
        saveDB(db);
        unlockBadgesIfNeeded(db);
        renderHome();

        const box = document.getElementById("assessResult");
        const ul = document.getElementById("adviceList");
        ul.innerHTML = advice.map((t) => `<li>${t}</li>`).join("");
        box.classList.remove("hidden");
        showToast("æµ‹è¯„å®Œæˆï¼Œå·²ä¸ºä½ ç”Ÿæˆå»ºè®®");
      });

      /*****************
       * è‡ªåŠ¨æ€ç»´è®°å½•
       *****************/
      const btnSaveTR = document.getElementById("btnSaveTR");
      btnSaveTR.addEventListener("click", () => {
        const contextSel = document.getElementById("trContext").value;
        const contextCustom = document.getElementById("trContextCustom").value.trim();
        const thought = document.getElementById("trThought").value.trim();
        const evidence = document.getElementById("trEvidence").value.trim();
        const emotion = Number(document.getElementById("trEmotion").value) || 5;
        const ctx = contextSel.includes("å…¶ä»–") ? (contextCustom || "æœªå¡«å†™") : (contextSel || contextCustom);

        if (!thought) return showToast("è¯·å…ˆå¡«å†™å½“æ—¶çš„æƒ³æ³•ï½");

        const db = loadDB();
        db.records.push({
          ts: Date.now(),
          context: ctx || "æœªå¡«å†™",
          thought,
          evidence,
          emotion,
        });
        touchStreak(db);
        saveDB(db);
        unlockBadgesIfNeeded(db);
        renderTRPreview();
        renderHome();
        showToast("å·²ä¿å­˜åˆ°æœ¬åœ°è®°å½•");
      });

      function renderTRPreview() {
        const db = loadDB();
        const box = document.getElementById("trPreview");
        if (!db.records.length) {
          box.textContent = "æš‚æ— è®°å½•ï¼Œä¿å­˜åä¼šæ˜¾ç¤ºé¢„è§ˆã€‚";
          return;
        }
        const r = db.records[db.records.length - 1];
        box.innerHTML = `
          <div class="flex justify-between items-start mb-3">
            <span class="text-sm text-gray-500">è®°å½•æ—¶é—´</span>
            <span class="text-sm font-medium">${fmtTime(r.ts)}</span>
          </div>
          <div class="mb-2"><span class="text-sm text-gray-500 block mb-1">æƒ…å¢ƒ</span><p class="text-sm">${r.context}</p></div>
          <div class="mb-2"><span class="text-sm text-gray-500 block mb-1">å½“æ—¶çš„æƒ³æ³•</span><p class="text-sm">${r.thought || "-"}</p></div>
          <div class="mb-2"><span class="text-sm text-gray-500 block mb-1">è¯æ®</span><p class="text-sm">${r.evidence || "-"}</p></div>
          <div><span class="text-sm text-gray-500 block mb-1">æƒ…ç»ªå¼ºåº¦</span>
            <div class="flex items-center">
              <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mr-2">
                <div class="h-full bg-red-400 rounded-full" style="width:${r.emotion * 10}%"></div>
              </div>
              <span class="text-sm font-medium">${r.emotion} åˆ†</span>
            </div>
          </div>
        `;
      }

      // å¯¼å‡º CSVï¼ˆæ€ç»´è®°å½•ï¼‰
      document.getElementById("btnExportCSV").addEventListener("click", () => {
        const { records } = loadDB();
        if (!records.length) return showToast("æš‚æ— æ•°æ®å¯å¯¼å‡º");
        const header = ["æ—¶é—´", "æƒ…å¢ƒ", "æƒ³æ³•", "è¯æ®", "æƒ…ç»ªå¼ºåº¦"];
        const rows = records.map((r) => [fmtTime(r.ts), r.context, r.thought.replace(/\n/g, " "), (r.evidence || "").replace(/\n/g, " "), r.emotion]);
        const csv = [header, ...rows].map((r) => r.map((x) => `"${(x + "").replace(/"/g, '""')}"`).join(",")).join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "mindfit_thought_records.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      // æ‰“å°ä¸º PDFï¼ˆæµè§ˆå™¨ç«¯ï¼‰
      document.getElementById("btnPrint").addEventListener("click", () => {
        const win = window.open("", "_blank");
        const { records } = loadDB();
        win.document.write(`<html><head><title>æ€ç»´è®°å½•æ‰“å°</title></head><body><h2>æ€ç»´è®°å½•</h2>`);
        if (!records.length) {
          win.document.write("<p>æš‚æ— è®°å½•</p>");
        } else {
          records.forEach((r) => {
            win.document.write(`<div style="margin:12px 0;padding:12px;border:1px solid #eee">
              <div><b>æ—¶é—´ï¼š</b>${fmtTime(r.ts)}</div>
              <div><b>æƒ…å¢ƒï¼š</b>${r.context}</div>
              <div><b>æƒ³æ³•ï¼š</b>${r.thought.replace(/\n/g, "<br/>")}</div>
              <div><b>è¯æ®ï¼š</b>${(r.evidence || "").replace(/\n/g, "<br/>")}</div>
              <div><b>æƒ…ç»ªå¼ºåº¦ï¼š</b>${r.emotion} åˆ†</div>
            </div>`);
          });
        }
        win.document.write(`</body></html>`);
        win.document.close();
        win.focus();
        win.print();
      });

      /*****************
       * æƒ…ç»ªç»ƒä¹ 
       *****************/
      document.querySelectorAll(".complete-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const card = btn.closest(".emotion-card");
          const cardId = card?.dataset?.card || "unknown";
          const db = loadDB();
          db.emotions.push({ card: cardId, ts: Date.now() });
          touchStreak(db);
          saveDB(db);
          unlockBadgesIfNeeded(db);
          renderEmotionStats();
          renderHome();

          // è§†è§‰æ ‡è®°
          card.classList.add("opacity-60");
          const sticker = card.querySelector(".done-sticker");
          if (sticker) sticker.classList.remove("hidden");
          btn.innerHTML = "å·²å®Œæˆ";
          btn.classList.remove("border-primary", "text-primary", "hover:bg-primary", "hover:text-white");
          btn.classList.add("border-gray-300", "text-gray-500", "bg-gray-100");
          showToast("å·²æ ‡è®°å®Œæˆï¼");
        });
      });

      function calcWeekStats(items) {
        const now = new Date();
        const startOfWeek = new Date(now);
        startOfWeek.setDate(now.getDate() - now.getDay()); // å‘¨æ—¥ä¸º 0
        const cnt = items.filter((x) => new Date(x.ts) >= startOfWeek).length;
        return cnt;
      }

      function renderEmotionStats() {
        const db = loadDB();
        const week = calcWeekStats(db.emotions);
        const total = db.emotions.length;
        document.getElementById("statWeek").textContent = `${Math.min(7, week)}/7`;
        document.getElementById("statTotal").textContent = total;
        document.getElementById("statStreak").textContent = db.streak.count;
        document.getElementById("statBar").style.width = `${Math.min(100, (week / 7) * 100)}%`;
      }

      function renderEmotionRecs() {
        const db = loadDB();
        const list = document.getElementById("emotionRecs");
        // ç®€å•æ¨èï¼šè‹¥æœ€è¿‘æƒ…ç»ªå¼ºåº¦>=7ï¼Œä¼˜å…ˆæ¨èå‘¼å¸ & æƒ…ç»ªå‘½åï¼›å¦åˆ™æ¨èæ­£å¿µé¥®é£Ÿ
        const lastTR = db.records.slice(-1)[0];
        const high = lastTR && lastTR.emotion >= 7;
        const recs = high
          ? [
              { title: "ç«‹åˆ»è¯•è¯• 4-2-6 å‘¼å¸", desc: "2 åˆ†é’Ÿå¿«é€Ÿç¨³å®šæƒ…ç»ª", tag: "åº”æ€¥", img: 21 },
              { title: "æƒ…ç»ªå‘½åæ¸…å•", desc: "ç»™æƒ…ç»ªä¸€ä¸ªåå­—å°±ä¼šå˜å°", tag: "æƒ…ç»ª", img: 22 },
            ]
          : [
              { title: "æ­£å¿µé¥®é£Ÿå…¥é—¨", desc: "ä»ä¸€é¢—è‘¡è„å¹²å¼€å§‹", tag: "æ­£å¿µ", img: 23 },
              { title: "èº«ä½“ä¸­ç«‹ 3 æ­¥", desc: "å…³æ³¨åŠŸèƒ½è€Œéå¤–è²Œ", tag: "ç†å¿µ", img: 24 },
            ];
        list.innerHTML = recs
          .map(
            (r) => `<div class="bg-white rounded-xl overflow-hidden card-shadow flex">
              <img src="https://picsum.photos/120/120?random=${r.img}" class="w-24 h-24 object-cover flex-shrink-0" alt="${r.title}">
              <div class="p-3 flex-grow">
                <h4 class="font-medium text-sm mb-1">${r.title}</h4>
                <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                <span class="badge bg-blue-50 text-primary">${r.tag}</span>
              </div>
            </div>`
          )
          .join("");
      }

      /*****************
       * è¡Œä¸ºå®éªŒ
       *****************/
      document.getElementById("btnSaveBX").addEventListener("click", () => {
        const db = loadDB();
        const item = {
          ts: Date.now(),
          belief: document.getElementById("bxBelief").value.trim(),
          steps: [document.getElementById("bxStep1").value.trim(), document.getElementById("bxStep2").value.trim(), document.getElementById("bxStep3").value.trim()].filter(Boolean),
          predict: document.getElementById("bxPredict").value.trim(),
          actual: document.getElementById("bxActual").value.trim(),
          learn: document.getElementById("bxLearn").value.trim(),
        };
        if (!item.belief) return showToast("è¯·å…ˆå¡«å†™æ‹…å¿§ä¿¡å¿µ");
        db.experiments.push(item);
        touchStreak(db);
        saveDB(db);
        unlockBadgesIfNeeded(db);
        renderBXList();
        showToast("å®éªŒå·²ä¿å­˜");
      });

      function renderBXList() {
        const db = loadDB();
        const box = document.getElementById("bxList");
        if (!db.experiments.length) {
          box.innerHTML = `<div class="text-sm text-gray-500">æš‚æ— è®°å½•</div>`;
          return;
        }
        box.innerHTML = db.experiments
          .slice(-3)
          .reverse()
          .map(
            (e) => `<div class="bg-white rounded-lg p-4 card-shadow">
            <div class="flex justify-between items-start mb-2">
              <h4 class="font-medium">å®éªŒï¼š${e.belief.slice(0, 16)}${e.belief.length > 16 ? "..." : ""}</h4>
              <span class="text-xs text-gray-500">${fmtTime(e.ts)}</span>
            </div>
            <p class="text-sm text-gray-600 line-clamp-2 mb-2">${e.predict ? "é¢„æµ‹ï¼š" + e.predict : ""}</p>
            <div class="flex justify-between items-center">
              <span class="badge bg-green-50 text-green-600">å·²ä¿å­˜</span>
            </div>
          </div>`
          )
          .join("");
      }

      /*****************
       * å†¥æƒ³/æ­£å¿µ
       *****************/
      const audio = document.getElementById("audio");
      const playBtn = document.getElementById("playPauseBtn");
      const playIcon = document.getElementById("playPauseIcon");
      const seekBar = document.getElementById("seekBar");
      const vol = document.getElementById("volumeBar");
      const cur = document.getElementById("currentTime");
      const total = document.getElementById("totalTime");

      let timerId = null;

      function updateTimeDisplay(sec) {
        const m = String(Math.floor(sec / 60)).padStart(2, "0");
        const s = String(Math.floor(sec % 60)).padStart(2, "0");
        return `${m}:${s}`;
      }

      function setTotal(sec) {
        total.textContent = updateTimeDisplay(sec);
        seekBar.max = String(sec);
      }

      setTotal(180); // é»˜è®¤ 3 åˆ†é’Ÿ

      // Audio controlsï¼ˆå¯é€‰ï¼‰
      playBtn.addEventListener("click", () => {
        if (audio.paused) {
          audio.play().catch(() => {});
          playBtn.innerHTML = '<i class="fa fa-pause"></i>';
          playIcon.className = "fa fa-pause text-white text-3xl";
        } else {
          audio.pause();
          playBtn.innerHTML = '<i class="fa fa-play"></i>';
          playIcon.className = "fa fa-play text-white text-3xl";
        }
      });
      audio.addEventListener("timeupdate", () => {
        seekBar.value = Math.floor(audio.currentTime);
        cur.textContent = updateTimeDisplay(audio.currentTime);
      });
      seekBar.addEventListener("input", () => (audio.currentTime = Number(seekBar.value)));
      vol.addEventListener("input", () => (audio.volume = Number(vol.value)));

      // è®¡æ—¶ç»ƒä¹ 
      document.getElementById("startPracticeBtn").addEventListener("click", () => {
        let sec = 0;
        clearInterval(timerId);
        timerId = setInterval(() => {
          sec += 1;
          cur.textContent = updateTimeDisplay(sec);
          seekBar.value = sec;
          if (sec >= 180) {
            clearInterval(timerId);
            const db = loadDB();
            db.mindfulness.push({ seconds: sec, ts: Date.now() });
            touchStreak(db);
            saveDB(db);
            unlockBadgesIfNeeded(db);
            renderHome();
            showToast("ç»ƒä¹ å®Œæˆï¼Œå·²è®°å½• 3 åˆ†é’Ÿ");
          }
        }, 1000);
      });

      document.getElementById("btnStepBack").addEventListener("click", () => (audio.currentTime = Math.max(0, audio.currentTime - 5)));
      document.getElementById("btnStepForward").addEventListener("click", () => (audio.currentTime = Math.min(Number(seekBar.max), audio.currentTime + 5)));

      document.getElementById("btnCache").addEventListener("click", () => {
        const db = loadDB();
        db.cachedAudio = true;
        saveDB(db);
        showToast("å·²è®°ä¸ºç¦»çº¿å¯ç”¨æç¤ºï¼ˆç¤ºä¾‹ï¼‰");
      });

      /*****************
       * æˆ‘çš„è®°å½•åˆ—è¡¨ & å¯¼å‡º
       *****************/
      document.querySelectorAll(".filter-btn").forEach((b) =>
        b.addEventListener("click", () => {
          document.querySelectorAll(".filter-btn").forEach((x) => x.classList.replace("bg-primary", "bg-gray-100"));
          document.querySelectorAll(".filter-btn").forEach((x) => x.classList.replace("text-white", "text-gray-600"));
          b.classList.replace("bg-gray-100", "bg-primary");
          b.classList.replace("text-gray-600", "text-white");
          renderRecordList(b.dataset.filter);
        })
      );

      function renderRecordList(filter = "all") {
        const db = loadDB();
        const box = document.getElementById("recordList");
        let items = [];

        if (filter === "all" || filter === "thought") {
          items = items.concat(db.records.map((r) => ({ type: "thought", ts: r.ts, data: r })));
        }
        if (filter === "all" || filter === "emotion") {
          items = items.concat(db.emotions.map((e) => ({ type: "emotion", ts: e.ts, data: e })));
        }
        if (filter === "all" || filter === "experiment") {
          items = items.concat(db.experiments.map((e) => ({ type: "experiment", ts: e.ts, data: e })));
        }
        if (filter === "all" || filter === "mindfulness") {
          items = items.concat(db.mindfulness.map((m) => ({ type: "mindfulness", ts: m.ts, data: m })));
        }
        if (filter === "all" || filter === "assessment") {
          items = items.concat(db.assessments.map((a) => ({ type: "assessment", ts: a.ts, data: a })));
        }

        items.sort((a, b) => b.ts - a.ts);

        if (!items.length) {
          box.innerHTML = `<div class="text-sm text-gray-500">æš‚æ— è®°å½•</div>`;
          return;
        }

        box.innerHTML = items
          .map((it) => {
            if (it.type === "thought") {
              const r = it.data;
              return `<div class="bg-white rounded-lg p-4 card-shadow">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2">
                      <i class="fa fa-pencil text-primary text-sm"></i>
                    </div>
                    <h4 class="font-medium">è‡ªåŠ¨æ€ç»´è®°å½•</h4>
                  </div>
                  <span class="text-xs text-gray-500">${fmtTime(it.ts)}</span>
                </div>
                <p class="text-sm text-gray-600 line-clamp-2 mb-3">æƒ…å¢ƒï¼š${r.context}â€¦ æƒ…ç»ªå¼ºåº¦ï¼š${r.emotion}åˆ†</p>
                <span class="badge bg-blue-50 text-primary">æ€ç»´</span>
              </div>`;
            }
            if (it.type === "emotion") {
              return `<div class="bg-white rounded-lg p-4 card-shadow">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-2">
                      <i class="fa fa-heart-o text-secondary text-sm"></i>
                    </div>
                    <h4 class="font-medium">æƒ…ç»ªç»ƒä¹ å®Œæˆ</h4>
                  </div>
                  <span class="text-xs text-gray-500">${fmtTime(it.ts)}</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">ç»ƒä¹ ï¼š${it.data.card}</p>
                <span class="badge bg-green-50 text-secondary">ç»ƒä¹ </span>
              </div>`;
            }
            if (it.type === "experiment") {
              const e = it.data;
              return `<div class="bg-white rounded-lg p-4 card-shadow">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-2">
                      <i class="fa fa-flask text-accent text-sm"></i>
                    </div>
                    <h4 class="font-medium">è¡Œä¸ºå®éªŒ</h4>
                  </div>
                  <span class="text-xs text-gray-500">${fmtTime(it.ts)}</span>
                </div>
                <p class="text-sm text-gray-600 line-clamp-2 mb-2">${e.belief}</p>
                <span class="badge bg-purple-50 text-purple-600">å®éªŒ</span>
              </div>`;
            }
            if (it.type === "mindfulness") {
              return `<div class="bg-white rounded-lg p-4 card-shadow">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center mr-2">
                      <i class="fa fa-headphones text-yellow-500 text-sm"></i>
                    </div>
                    <h4 class="font-medium">å†¥æƒ³ç»ƒä¹ </h4>
                  </div>
                  <span class="text-xs text-gray-500">${fmtTime(it.ts)}</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">æ—¶é•¿ï¼š${Math.round(it.data.seconds / 60)} åˆ†é’Ÿ</p>
                <span class="badge bg-yellow-50 text-yellow-600">å†¥æƒ³</span>
              </div>`;
            }
            if (it.type === "assessment") {
              return `<div class="bg-white rounded-lg p-4 card-shadow">
                <div class="flex justify-between items-start mb-2">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center mr-2">
                      <i class="fa fa-question-circle text-pink-500 text-sm"></i>
                    </div>
                    <h4 class="font-medium">èº«å¿ƒè½»æµ‹è¯„</h4>
                  </div>
                  <span class="text-xs text-gray-500">${fmtTime(it.ts)}</span>
                </div>
                <p class="text-sm text-gray-600 mb-2">æ€»åˆ†ï¼š${it.data.score}ï¼ˆ9~45ï¼‰</p>
                <span class="badge bg-pink-50 text-pink-600">æµ‹è¯„</span>
              </div>`;
            }
          })
          .join("");
      }

      // å¯¼å‡ºæ‰€æœ‰ CSV
      document.getElementById("btnExportAll").addEventListener("click", () => {
        const db = loadDB();
        const combine = [];
        db.records.forEach((r) => combine.push(["æ€ç»´è®°å½•", fmtTime(r.ts), r.context, r.thought.replace(/\n/g, " "), (r.evidence || "").replace(/\n/g, " "), r.emotion]));
        db.emotions.forEach((e) => combine.push(["æƒ…ç»ªç»ƒä¹ ", fmtTime(e.ts), e.card, "", "", ""]));
        db.experiments.forEach((e) => combine.push(["è¡Œä¸ºå®éªŒ", fmtTime(e.ts), e.belief.replace(/\n/g, " "), (e.predict || "").replace(/\n/g, " "), (e.actual || "").replace(/\n/g, " "), ""]));
        db.mindfulness.forEach((m) => combine.push(["å†¥æƒ³", fmtTime(m.ts), `æ—¶é•¿${Math.round(m.seconds / 60)}åˆ†é’Ÿ`, "", "", ""]));
        db.assessments.forEach((a) => combine.push(["æµ‹è¯„", fmtTime(a.ts), `æ€»åˆ†${a.score}`, "", "", ""]));
        if (!combine.length) return showToast("æš‚æ— æ•°æ®å¯å¯¼å‡º");

        const header = ["ç±»å‹", "æ—¶é—´", "A", "B", "C", "D"];
        const csv = [header, ...combine].map((r) => r.map((x) => `"${(x + "").replace(/"/g, '""')}"`).join(",")).join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "mindfit_all_records.csv"; a.click();
        URL.revokeObjectURL(url);
      });

      // æ¸…ç©ºæ•°æ®
      document.getElementById("btnClearAll").addEventListener("click", () => {
        if (!confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")) return;
        localStorage.removeItem(DB_KEY);
        showToast("å·²æ¸…ç©ºæœ¬åœ°æ•°æ®");
        renderHome();
        renderRecordList("all");
        renderBadges();
      });

      /*****************
       * å¾½ç« ç³»ç»Ÿ
       *****************/
      const BADGE_RULES = [
        { id: "tr_3", name: "æ€ç»´è®°å½•è€…", icon: "fa-pencil", color: "text-primary", desc: "å®Œæˆ 3 æ¬¡è‡ªåŠ¨æ€ç»´è®°å½•", check: (db) => db.records.length >= 3 },
        { id: "emo_5", name: "æƒ…ç»ªè°ƒèŠ‚æ–°æ‰‹", icon: "fa-heart-o", color: "text-secondary", desc: "å®Œæˆ 5 æ¬¡æƒ…ç»ªç»ƒä¹ ", check: (db) => db.emotions.length >= 5 },
        { id: "streak_7", name: "åšæŒè€…", icon: "fa-calendar-check-o", color: "text-accent", desc: "è¿ç»­ 7 å¤©ä½¿ç”¨", check: (db) => db.streak.count >= 7 },
      ];

      function unlockBadgesIfNeeded(db) {
        let unlockedName = null;
        BADGE_RULES.forEach((b) => {
          if (b.check(db) && !db.badges[b.id]) {
            db.badges[b.id] = true;
            unlockedName = b.name;
          }
        });
        saveDB(db);
        if (unlockedName) {
          const banner = document.getElementById("badgeBanner");
          const text = document.getElementById("badgeBannerText");
          text.textContent = unlockedName;
          banner.classList.remove("hidden");
          setTimeout(() => banner.classList.add("hidden"), 3200);
        }
      }

      function renderBadges() {
        const db = loadDB();
        const unlocked = document.getElementById("badgeUnlocked");
        const locked = document.getElementById("badgeLocked");
        const renderCard = (b, dim = false) => `
          <div class="badge-card bg-white rounded-xl p-4 card-shadow flex flex-col items-center ${dim ? 'opacity-50' : ''}">
            <div class="w-16 h-16 rounded-full ${dim ? 'bg-gray-100' : 'bg-blue-100'} flex items-center justify-center mb-2">
              <i class="fa ${b.icon} ${b.color} text-2xl"></i>
            </div>
            <h4 class="text-sm font-medium text-center mb-1">${b.name}</h4>
            <p class="text-xs text-gray-500 text-center mb-2">${b.desc}</p>
          </div>`;
        unlocked.innerHTML = BADGE_RULES.filter((b) => db.badges[b.id]).map((b) => renderCard(b)).join("") || `<div class="text-sm text-gray-500">æš‚æ— </div>`;
        locked.innerHTML = BADGE_RULES.filter((b) => !db.badges[b.id]).map((b) => renderCard(b, true)).join("") || `<div class="text-sm text-gray-500">å…¨éƒ¨è§£é”å•¦ ğŸ‰</div>`;
      }

      /*****************
       * é¦–é¡µæ¸²æŸ“ï¼ˆè¿›åº¦/æœ€è¿‘/æ¨èï¼‰
       *****************/
      function renderHome() {
        const db = loadDB();
        // è¿›åº¦ï¼šç²—ç•¥ç”¨å„æ¨¡å—å®Œæˆé‡åˆæˆ
        const total = db.records.length + db.emotions.length + db.mindfulness.length + db.experiments.length + db.assessments.length;
        const percent = Math.max(5, Math.min(100, Math.round((total / 20) * 100))); // 20 æ¬¡å®Œæˆâ‰ˆæ»¡è¿›åº¦
        document.getElementById("progressBar").style.width = `${percent}%`;

        // æœ€è¿‘è®°å½•ï¼šå–æœ€è¿‘ 2 æ¡ï¼ˆæ€ç»´/ç»ƒä¹ /å†¥æƒ³/å®éªŒ/æµ‹è¯„æ··æ’ï¼‰
        const recentBox = document.getElementById("recentList");
        const all = []
          .concat(db.records.map((r) => ({ type: "thought", ts: r.ts, tag: "æ€ç»´", icon: "fa-pencil", color: "text-primary" })))
          .concat(db.emotions.map((e) => ({ type: "emotion", ts: e.ts, tag: "ç»ƒä¹ ", icon: "fa-heart-o", color: "text-secondary" })))
          .concat(db.mindfulness.map((m) => ({ type: "mindfulness", ts: m.ts, tag: "å†¥æƒ³", icon: "fa-headphones", color: "text-yellow-500" })))
          .concat(db.experiments.map((m) => ({ type: "experiment", ts: m.ts, tag: "å®éªŒ", icon: "fa-flask", color: "text-accent" })))
          .concat(db.assessments.map((a) => ({ type: "assessment", ts: a.ts, tag: "æµ‹è¯„", icon: "fa-question-circle", color: "text-pink-500" })));
        all.sort((a, b) => b.ts - a.ts);
        const slice = all.slice(0, 2);
        if (!slice.length) {
          recentBox.innerHTML = `<div class="text-sm text-gray-500">æš‚æ— è®°å½•ï¼Œå…ˆå»è¯•è¯•ä¸Šæ–¹çš„å·¥å…·å¡ç‰‡å§ï½</div>`;
        } else {
          recentBox.innerHTML = slice
            .map(
              (x) => `<div class="bg-white rounded-lg p-4 card-shadow flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3">
                    <i class="fa ${x.icon} ${x.color}"></i>
                  </div>
                  <div>
                    <p class="font-medium">${x.tag}è®°å½•</p>
                    <p class="text-sm text-gray-500">${fmtTime(x.ts)}</p>
                  </div>
                </div>
                <span class="text-xs bg-gray-50 text-gray-600 px-2 py-1 rounded-full">${x.tag}</span>
              </div>`
            )
            .join("");
        }

        // æ¨èå†…å®¹ï¼šæ ¹æ®æœ€è¿‘ä¸€æ¬¡æƒ…ç»ªå¼ºåº¦
        const recBox = document.getElementById("recommendList");
        const last = db.records.slice(-1)[0];
        const items =
          last && last.emotion >= 7
            ? [
                { img: 31, title: "ç„¦è™‘æ—¶çš„ 90 ç§’æ–¹æ³•", desc: "è¯†åˆ«æƒ…ç»ªâ†’æ·±å‘¼å¸â†’æ”¾æ¾æ‰«æ" },
                { img: 32, title: "ä¸¤åˆ†é’Ÿè‡ªæˆ‘è‚¯å®šè¯­", desc: "å†™ä¸‹ 3 æ¡èº«ä½“åŠŸèƒ½æ„Ÿæ©" },
              ]
            : [
                { img: 33, title: "èº«ä½“ä¸­ç«‹å…¥é—¨", desc: "ä»åŠŸèƒ½ä¸å¥åº·è§’åº¦çœ‹å¾…èº«ä½“" },
                { img: 34, title: "æ­£å¿µé¥®é£Ÿ 5 æ­¥", desc: "æ…¢ä¸€ç‚¹ï¼Œå’Œå‘³é“å¥½å¥½ç›¸å¤„" },
              ];
        recBox.innerHTML = items
          .map(
            (r) => `<div class="bg-white rounded-xl overflow-hidden card-shadow">
              <img src="https://picsum.photos/400/200?random=${r.img}" alt="${r.title}" class="w-full h-40 object-cover">
              <div class="p-4">
                <h4 class="font-semibold mb-1">${r.title}</h4>
                <p class="text-sm text-gray-500 mb-3 line-clamp-2">${r.desc}</p>
                <div class="flex items-center justify-between">
                  <span class="text-xs text-gray-400">2 åˆ†é’Ÿé˜…è¯»</span>
                  <button class="text-primary text-sm">æŸ¥çœ‹</button>
                </div>
              </div>
            </div>`
          )
          .join("");
      }

      // é¦–æ¬¡è¿›å…¥ï¼Œæ¸²æŸ“é¦–é¡µ
      renderHome();
      renderTRPreview();
    });
  </script>
</body>
</html>



